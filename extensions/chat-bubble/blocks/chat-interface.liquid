{{ 'standalone-chat.css' | asset_url | stylesheet_tag }}

<div id="shop-ai-chatbot-root-container">
  {# This div will be the entry point for your standalone-chat-logic.js to build the UI #}
  {# The UI defined in the old chatbot.html will be constructed here by standalone-chat-logic.js #}
</div>

{# Pass essential Shopify data to the standalone chatbot scripts #}
<script>
  // Ensure this data is properly escaped and handled if it can contain user-input or special characters.
  // For simple IDs and URLs, JSON stringify is a good measure.
  window.shopifyShopId = {{ shop.permanent_domain | json }}; // Using permanent_domain as a stable shop identifier
  window.shopifyShopName = {{ shop.name | json }};
  window.shopifyAppUrl = {{ app.url | json }}; // Your Remix app's base URL, useful for API calls to your backend
  window.initialChatBubbleColor = {{ block.settings.chat_bubble_color | json }}; // Example setting from schema

  // Potentially, customer data if available and consented:
  // {% if customer %}
  //   window.shopifyCustomer = {
  //     id: {{ customer.id | json }},
  //     email: {{ customer.email | json }},
  //     firstName: {{ customer.first_name | json }},
  //     lastName: {{ customer.last_name | json }}
  //   };
  // {% else %}
  //   window.shopifyCustomer = null;
  // {% endif %}
</script>

{# Load the default config first, then the api_handler, then the main logic script #}
{# These scripts will use the window.shopifyShopId and other variables set above #}
<script src="{{ 'config.js' | asset_url }}" defer></script>
<script src="{{ 'api_handler.js' | asset_url }}" defer></script>
<script src="{{ 'standalone-chat-logic.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "AI Chat Assistant Loader",
  "target": "body",
  "settings": [
    {
      "type": "text",
      "id": "placeholder_setting",
      "label": "Placeholder Setting",
      "default": "This is a placeholder. Configure in app.",
      "info": "Most chatbot settings are now managed in the app admin dashboard."
    },
    {
      "type": "color",
      "id": "chat_bubble_color",
      "label": "Chat Bubble Accent Color",
      "info": "This color might be used by the chat bubble design if it's part of an app block. For the full chat window, settings are loaded from the app.",
      "default": "#E57399"
    }
    // This schema is kept minimal as the full configuration is fetched from the app's backend (via Redis).
    // It's mainly for the app block's context in the theme editor if needed, or for very basic initial values.
  ],
  "javascript_asset_url": "{{ 'standalone-chat-loader.js' | asset_url }}", // Optional: if you need a tiny loader script for this block specifically
  "stylesheet_asset_url": "{{ 'standalone-chat-block-styles.css' | asset_url }}" // Optional: if you have styles specific to this block wrapper
}
{% endschema %}
